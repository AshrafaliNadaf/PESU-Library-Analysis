{% block content %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/png" href="/static/img/logo.png"> 
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>
    Reports | PESU Library Analysis
  </title>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
  <link href="/static/css/material-dashboard.css?v=2.1.1" rel="stylesheet" />
  <link href="/static/demo/demo.css" rel="stylesheet" />
</head>

<body class="" >
  <div class="wrapper ">
    <div class="sidebar" data-color="purple" data-background-color="white" data-image="../static/img/pesu_globe.jpg">
      <div class="">
        <img class="logo card-img" src="/static/img/pes-logo.png" alt="not fount"></img>
      </div>
      <div class="sidebar-wrapper">
        <ul class="nav">
          <li class="nav-item  ">
            <a class="nav-link" href="{% url 'home' %}">
              <i class="material-icons">dashboard</i>
              <p>Dashboard</p>
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="{% url 'bookir' %}">
              <i class="material-icons">content_paste</i>
              <p>Book Issue/Return</p>
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="{% url 'visitors' %}">
              <i class="material-icons">person</i>
              <p>Visitors</p>
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="{% url 'newbook' %}">
              <i class="material-icons">library_books</i>
              <p>New Book Request</p>
            </a>
          </li>
          <li class="nav-item active ">
            <a class="nav-link" href="{% url 'report' %}">
              <i class="material-icons">bubble_chart</i>
              <p>Reports</p>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="main-panel" >
      <!-- Navbar --> 
      <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
        <div class="container-fluid" >
          <div class="navbar-wrapper">
            <a class="navbar-brand" href="{% url 'report' %}">Reports</a>
          </div>
          <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
          </button>
          <div class="collapse navbar-collapse justify-content-end">
            {% comment %} <form class="navbar-form">
              <div class="input-group no-border">
                <input type="text" value="" class="form-control" placeholder="Search...">
                <button type="submit" class="btn btn-white btn-round btn-just-icon">
                  <i class="material-icons">search</i>
                  <div class="ripple-container"></div>
                </button>
              </div>
            </form>{% endcomment %}
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" href="{% url 'home' %}">
                  <i class="material-icons">dashboard</i>
                  <p class="d-lg-none d-md-block">
                    Stats
                  </p>
                </a>
              </li>
              {% comment %}<li class="nav-item dropdown">
                <a class="nav-link" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">notifications</i>
                  <span class="notification">5</span>
                  <p class="d-lg-none d-md-block">
                    Some Actions
                  </p>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                  <a class="dropdown-item" href="#">Mike John responded to your email</a>
                  <a class="dropdown-item" href="#">You have 5 new tasks</a>
                  <a class="dropdown-item" href="#">You're now friend with Andrew</a>
                  <a class="dropdown-item" href="#">Another Notification</a>
                  <a class="dropdown-item" href="#">Another One</a>
                </div>
              </li>{% endcomment %}
              <li class="nav-item dropdown">
                <a class="nav-link" href="#pablo" id="navbarDropdownProfile" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">person</i>
                  <p class="d-lg-none d-md-block">
                    Account
                  </p>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownProfile">
                  <a class="dropdown-item" href="{% url 'profile' %}">Profile</a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="{% url 'login' %}">Log out</a>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </nav>
   
     <div class="content" >
        <div class="container-fluid pull-right">        
          <div class="row"> 
            <div class="col-md-8">  
              <div class="card">
                <div class="card-body"> 
                  <canvas id="newbookchart" data-url="{% url 'newbookchart' %}"></canvas>
                </div>
              </div> 
            </div>

            {% comment %}  <div class="col-md-8 ">  
              <div class="card">
                <div class="card-body"> 
                  <canvas id="bookir_chart1" data-url="{% url 'bookir_chart1' %}"></canvas>
                </div>
              </div> 
            </div>

            <div class="col-md-8">  
              <div class="card">
                <div class="card-body"> 
                  <canvas id="bookir_chart2" data-url="{% url 'bookir_chart2' %}"></canvas>
                </div>
              </div> 
            </div>
            {% endcomment %}

          </div>
        </div>
      </div>

    </div>
  </div>
{% endblock %}

<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.4.0/dist/chartjs-plugin-datalabels.min.js"></script> 
  <script> 
   var $populationChart = $("#newbookchart"); 
    $.ajax({ 
      url: $populationChart.data("url"),
      success: function(data) { 
        // drawLineGraph(data, 'myChartline'); 
        drawBarGraph(data, 'myChartBar'); 
        console.log("drawing"); 
      }, 
      error: function(error_data) { 
        console.log(error_data); 
      } 
    }) 
  function drawBarGraph(data, id) 
    { 
      // var labels = data.labels; 
      // var chartLabel = data.chartLabel; 
      // var chartdata = data.chartdata; 
      var ctx = $populationChart[0].getContext("2d");

          new Chart(ctx, {
            type: 'pie',
            data: {
              labels: data.labels,
              datasets: [{
                label: 'New book Request',
               backgroundColor: ["#e67f83","#f0b8b8"],
                data: data.data
              }]          
            },
           options: { 
              scales: { 
                yAxes: [{ 
                  ticks: { 
                    beginAtZero: true 
                          },
                    scaleLabel: {
                          display: true,
                           labelString: 'No. of copies Requested'
               
                        }
                      }] 
                    },
              plugins: {
                  datalabels: {
                      formatter: (value, ctx) => {
                        let datasets = ctx.chart.data.datasets;
                        if (datasets.indexOf(ctx.dataset) === datasets.length - 1) {
                              let sum = datasets[0].data.reduce((a, b) => a + b, 0);
                              let percentage = Math.round((value / sum) * 100) + '%';
                              return percentage;
                            } else {
                              return percentage;
                            }
                        },
                         color: '#fff',
                      }
                    }
          
                     } 

      });
      
       
    } 
    
  </script> 


